<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nonlinear Correction calculation in the IRs &mdash; irnl-rdt-correction 0.0.2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome the documentation of the IRNL RDT Correction!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/omc_logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Nonlinear Correction calculation in the IRs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">irnl-rdt-correction</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Nonlinear Correction calculation in the IRs</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/pylhc/irnl_rdt_correction" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="module-irnl_rdt_correction.irnl_rdt_correction"></span><section id="nonlinear-correction-calculation-in-the-irs">
<h1>Nonlinear Correction calculation in the IRs<a class="headerlink" href="#nonlinear-correction-calculation-in-the-irs" title="Permalink to this heading"></a></h1>
<p>Performs local correction of the Resonance Driving Terms (RDTs)
in the Insertion Regions (IRs) based on the principle described in
<a class="footnote-reference brackets" href="#bruningdynamicaperturestudies2004" id="id1">1</a> with the addition of correcting
feed-down and using feed-down to correct lower order RDTs.
Details can be found in <a class="footnote-reference brackets" href="#dillynonlinearircorrections2022" id="id2">2</a> .</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="bruningdynamicaperturestudies2004"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>O. Bruening et al.,
Dynamic aperture studies for the LHC separation dipoles. (2004)
<a class="reference external" href="https://cds.cern.ch/record/742967">https://cds.cern.ch/record/742967</a></p>
</dd>
<dt class="label" id="dillynonlinearircorrections2022"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id3">2</a>,<a href="#id4">3</a>)</span></dt>
<dd><p>J. Dilly et al.,
Corrections of high-order nonlinear errors in the LHC and HL-LHC insertion regions. (2022)</p>
</dd>
</dl>
<p>author: Joschua Dilly</p>
<dl class="py class">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.DotDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">DotDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#DotDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.DotDict" title="Permalink to this definition"></a></dt>
<dd><p>Make dict fields accessible by attributes.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.Timer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">Timer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'start',</span> <span class="pre">print_fun:</span> <span class="pre">~typing.Callable[[str],</span> <span class="pre">None]</span> <span class="pre">=</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">print&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#Timer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.Timer" title="Permalink to this definition"></a></dt>
<dd><p>Collect Times and print a summary at the end.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.build_equation_system">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">build_equation_system</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rdt_maps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correctors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">IRCorrector</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beams</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feeddown</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#build_equation_system"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.build_equation_system" title="Permalink to this definition"></a></dt>
<dd><p>Builds equation system as in Eq. (43) in <a class="footnote-reference brackets" href="#dillynonlinearircorrections2022" id="id3">2</a>
for a given ip for all given optics and error files (i.e. beams) and rdts.</p>
<dl class="simple">
<dt>Returns</dt><dd><p>b_matrix: np.array N_rdts x  N_correctors
integral: np.array N_rdts x 1</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.get_available_correctors">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">get_available_correctors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field_components</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">IRCorrector</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#get_available_correctors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.get_available_correctors" title="Permalink to this definition"></a></dt>
<dd><p>Gets the available correctors by checking for their presence in the optics.
If the corrector is not found in this ip, the ip is skipped.
If only one corrector (left or right) is present a warning is issued.
If one corrector is present in only one optics (and not in the other)
an Environment Error is raised.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.get_corrector_coefficient">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">get_corrector_coefficient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rdt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">RDT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrector</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">IRCorrector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#get_corrector_coefficient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.get_corrector_coefficient" title="Permalink to this definition"></a></dt>
<dd><p>Calculate B-Matrix Element for Corrector.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.get_elements_integral">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">get_elements_integral</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rdt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ip</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feeddown</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#get_elements_integral"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.get_elements_integral" title="Permalink to this definition"></a></dt>
<dd><p>Calculate the RDT integral for all elements of the IP.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.get_integral_sign">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">get_integral_sign</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#get_integral_sign"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.get_integral_sign" title="Permalink to this definition"></a></dt>
<dd><p>Sign of the integral and corrector for this side.</p>
<p>This is the exp(iπnθ(s_w−s_IP)) part of Eq. (40) in
<a class="footnote-reference brackets" href="#dillynonlinearircorrections2022" id="id4">2</a>,</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.init_corrector_and_optics_values">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">init_corrector_and_optics_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">correctors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">IRCorrector</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_optics</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_settings</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#init_corrector_and_optics_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.init_corrector_and_optics_values" title="Permalink to this definition"></a></dt>
<dd><p>If wished save original corrector values from optics (for later restoration)
and sync corrector values in list and optics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.log_setup">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">log_setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#log_setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.log_setup" title="Permalink to this definition"></a></dt>
<dd><p>Set up a basic logger.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.main">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">opt</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">TfsDataFrame</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.main" title="Permalink to this definition"></a></dt>
<dd><p>Get correctors and their optimal powering to minimize the given RDTs.</p>
<dl class="field-list simple">
<dt class="field-odd">Keyword Arguments</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>optics</strong> (<em>list</em><em>[</em><em>str/Path/DataFrame</em><em>]</em>) -- Path(s) to optics file(s) or DataFrame(s) of optics.
Needs to contain only the elements to be corrected
(e.g. only the ones in the IRs).
All elements from the error-files need to be present.
Required!</p></li>
<li><p><strong>errors</strong> (<em>list</em><em>[</em><em>str/Path/DataFrame</em><em>]</em>) -- Path(s) to error file(s) or DataFrame(s) of errors.
Can contain less elements than the optics files,
these elements are then assumed to have no errors.
Required!</p></li>
<li><p><strong>beams</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) -- Which beam the files come from (1, 2 or 4).
Required!</p></li>
<li><p><strong>output</strong> (<em>str/Path</em>) -- Path to write command and tfs_df file.
Extension (if given) is ignored and replaced with ‘.tfs’ and ‘.madx’
for the Dataframe and the command file respectively.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>rdts</strong> (<em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>dict</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) -- RDTs to correct.
Format: ‘Fjklm’; or ‘Fjklm*’ to correct for
this RDT in Beam 2 using beta-symmetry (jk &lt;-&gt; lm).
The RDTs can be either given as a list, then the appropriate correctors
are determined by jklmn.
Alternatively, the input can be a dictionary,
where the keys are the RDT names as before, and the values are a list
of correctors to use, e.g. ‘b5’ for normal decapole corrector,
‘a3’ for skew sextupole, etc.
If the order of the corrector is higher than the order of the RDT,
the feed-down from the corrector is used for correction.
In the case where multiple orders of correctors are used,
increasing <code class="docutils literal notranslate"><span class="pre">iterations</span></code> might be useful.
Default: Standard RDTs for given <code class="docutils literal notranslate"><span class="pre">accel</span></code> (see <code class="docutils literal notranslate"><span class="pre">DEFAULT_RDTS</span></code> in this file).</p></li>
<li><p><strong>rdts2</strong> (<em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>dict</em><em>[</em><em>str</em><em>, </em><em>list</em><em>[</em><em>str</em><em>]</em>) -- RDTs to correct for second beam/file, if different from first.
Same format rules as for <code class="docutils literal notranslate"><span class="pre">rdts</span></code>. Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>accel</strong> (<em>str</em>) -- Which accelerator we have. One of ‘lhc’, ‘hllhc’.
Default: <code class="docutils literal notranslate"><span class="pre">lhc</span></code>.</p></li>
<li><p><strong>feeddown</strong> (<em>int</em>) -- Order of Feeddown to include.
Default: <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>ips</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) -- In which IPs to correct.
Default: <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">5,</span> <span class="pre">8]</span></code>.</p></li>
<li><p><strong>solver</strong> (<em>str</em>) -- Solver to use. One of ‘lstsq’, ‘inv’ or ‘linear’.
Default <code class="docutils literal notranslate"><span class="pre">lstsq</span></code>.</p></li>
<li><p><strong>update_optics</strong> (<em>bool</em>) -- Sorts the RDTs to start with the highest order
and updates the corrector strengths in the optics
after calculation, so the feeddown to lower order
correctors is included.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>ignore_corrector_settings</strong> (<em>bool</em>) -- Ignore the current settings of the correctors.
If this is not set the corrector values of the
optics are used as initial conditions.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>ignore_missing_columns</strong> (<em>bool</em>) -- If set, missing strength columns in any
of the input files are assumed to be
zero, instead of raising an error.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>iterations</strong> (<em>int</em>) -- Reiterate correction, starting with the previously
calculated values.
Default: <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the string contains the madx-commands used to power the correctors;
the dataframe contains the same values in a pandas DataFrame.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple[string, Dataframe]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.restore_optics_values">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">restore_optics_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">saved_values</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#restore_optics_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.restore_optics_values" title="Permalink to this definition"></a></dt>
<dd><p>Restore saved initial corrector values (if any) to optics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.solve">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">solve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rdt_maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors_dfs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#solve"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.solve" title="Permalink to this definition"></a></dt>
<dd><p>Calculate corrections.
They are grouped into rdt’s with common correctors. If possible, these are
ordered from highest order to lowest, to be able to update optics and include
their feed-down.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.solve_equation_system">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">solve_equation_system</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">correctors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">IRCorrector</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lhs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rhs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solver</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#solve_equation_system"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.solve_equation_system" title="Permalink to this definition"></a></dt>
<dd><p>Solves the system with the given solver.</p>
<p>The result is transferred to the corrector values internally.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.sort_rdts">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">sort_rdts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rdts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rdts2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#sort_rdts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.sort_rdts" title="Permalink to this definition"></a></dt>
<dd><p>Sorts RDTs by reversed-order and orientation (skew, normal).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.switch_signs_for_beams">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">switch_signs_for_beams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">TfsDataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">TfsDataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beams</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#switch_signs_for_beams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.switch_signs_for_beams" title="Permalink to this definition"></a></dt>
<dd><p>Switch the signs for Beam optics.
This is due to the switch in direction between beam and
(anti-) symmetry after a rotation of 180deg around the y-axis of magnets.
Magnet orders that show anti-symmetry are: a1 (K0SL), b2 (K1L), a3 (K2SL), b4 (K3L) etc.</p>
<p>This brings the Beam 2 KNL and x values to Beam 4 definition.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="irnl_rdt_correction.irnl_rdt_correction.update_optics">
<span class="sig-prename descclassname"><span class="pre">irnl_rdt_correction.irnl_rdt_correction.</span></span><span class="sig-name descname"><span class="pre">update_optics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">correctors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">IRCorrector</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optics_dfs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beams</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/irnl_rdt_correction/irnl_rdt_correction.html#update_optics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#irnl_rdt_correction.irnl_rdt_correction.update_optics" title="Permalink to this definition"></a></dt>
<dd><p>Updates the corrector strength values in the current optics.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome the documentation of the IRNL RDT Correction!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>